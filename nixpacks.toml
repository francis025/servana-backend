# Nixpacks configuration for Railway deployment
[phases.setup]
nixPkgs = ["php81", "php81Packages.composer", "php81Extensions.mysqli", "php81Extensions.pdo", "php81Extensions.pdo_mysql", "php81Extensions.mbstring", "php81Extensions.xml", "php81Extensions.curl", "php81Extensions.zip", "php81Extensions.gd", "php81Extensions.intl", "php81Extensions.fileinfo"]

[phases.install]
cmds = ["composer install --no-dev --optimize-autoloader"]

[phases.build]
cmds = [
    "chmod +x configure_database.sh",
    "chmod -R 777 writable",
    "php spark cache:clear || true",
    "rm -rf writable/cache/* || true"
]

[start]
cmd = "chmod -R 777 writable && CI_ENVIRONMENT=production php -d display_errors=0 -d error_reporting=24575 -d variables_order=EGPCS -d opcache.enable=0 -d opcache.enable_cli=0 -S 0.0.0.0:$PORT -t public public/router.php"
